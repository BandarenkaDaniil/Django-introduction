{% extends 'railways/base.html' %}
{% load static %}
{% block content %}

    <script src="{% static 'railways/scripts/moment.js' %}">
    </script>

    <script src="{% static 'railways/scripts/utils.js' %}">
    </script>

    <script src="{% static 'railways/scripts/getRides.js' %}">
    </script>

    <script src="{% static 'railways/scripts/buyTicket.js' %}">
    </script>

    <script src="{% static 'railways/scripts/logout.js' %}">
    </script>

    <script src="{% static 'railways/scripts/getUserTickets.js' %}">
    </script>

    <script src="{% static 'railways/scripts/loginUser.js' %}">
    </script>

    <div class="modal fade" id="cartModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">

                <div class="modal-header">
                    <h4 class="modal-title">Your tickets</h4>
                    <button type="button" class="close" data-dismiss="modal">
                        &times;
                    </button>
                </div>

                <div class="modal-body" id="trainsModalBody">
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary"
                            data-dismiss="modal">Close
                    </button>
                </div>

            </div>
        </div>
    </div>

    <div class="modal fade" id="loginModal">
        <div class="modal-dialog modal-login">
            <div class="modal-content">

                <div class="modal-header">
                    <h4 class="modal-title">Log in</h4>
                    <button type="button" class="close" data-dismiss="modal">
                        &times;
                    </button>
                </div>

                <div class="modal-body" id="loginModalBody">
                    <form id="loginForm" style="display: none">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text">Your Email:</span>
                            </div>
                            <input type="email" class="form-control"
                                   placeholder="Email" id="email"
                                   name="email">
                        </div>

                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text">Password:</span>
                            </div>
                            <input type="password" class="form-control"
                                   placeholder="Password" id="password"
                                   name="password">
                        </div>

                        <button type="submit" class="btn  btn-primary">Log in
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="container" style="margin-top: 50px">
        <form id="dataSpecifyingForm" style="display: none">
            <div class="form-group">
                <label for="departure_station">Departure station:</label>
                <input type="text" class="form-control" id="departureStation"
                       name="departure_station">
            </div>
            <div class="form-group">
                <label for="arrival_station">Arrival station:</label>
                <input type="text" class="form-control" id="arrivalStation"
                       name="arrival_station">
            </div>

            <div class="form-group">
                <label for="departure_date">Departure date:</label>
                <input type="date" class="form-control" id="departureDate"
                       name="departure_date">
            </div>

            <button type="submit" class="btn btn-primary">Choose</button>
        </form>
    </div>

    <div class="container" id="trains" style="margin-top: 50px">
    </div>

    <script>
        let cartButton = $("#cartNavButton");

        if (getCookie('Authorization') === '') {
            let loginForm = $("#loginForm");

            loginForm.show();

            loginForm.on(
                "submit",
                loginUser
            );
        } else {
            $("#dataSpecifyingForm").show();

            cartButton.show();

            $('#logoutNavButton').on(
                'click',
                logout
            )
        }

        cartButton.on("click",
            getUserTickets
        );
    </script>

    <script>
        let dataSpecifyingForm = $("#dataSpecifyingForm");

        function submitDataSpecifyingForm(event) {
            event.preventDefault();
            getRides();
        }

        $("#trains").on(
            'click',
            '.btn-buy-ticket',
            buyTicket
        );

        dataSpecifyingForm.on(
            "submit",
            submitDataSpecifyingForm
        );
    </script>
{% endblock content %}